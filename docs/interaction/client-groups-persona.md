# 客户端分组管理 — Persona 与场景

## 设计理念

遵循 **Goal-Directed Design** 原则，用户的目标是"把设备分组并应用规则"，而不是"操作分组结构"。

---

## Primary Persona: "系统管理员 Alex"

### 基本信息

- **姓名**: Alex
- **角色**: 中小型企业 IT 管理员 / 技术负责人
- **经验**: 5-10 年网络管理经验，熟悉 DNS 基础
- **环境**: 管理着 20-200 台设备的网络环境
- **时间压力**: 高，每天要处理多个中断和请求

### 用户画像

**行为特征**:
- 批量操作偏好：喜欢一次性处理多个设备
- 效率至上：不愿意重复做同样的事情
- 安全意识强：担心配置错误导致服务中断
- 喜欢验证：修改后总要检查几台设备的响应

**日常场景**:
1. 新员工入职，需要将 5 台设备加入"研发部门"组并应用研发规则
2. 安全审计，需要临时将所有 IoT 设备加入"隔离组"
3. 季度审计，导出所有设备及其分组配置用于合规报告
4. 接到投诉，某个部门无法访问某类网站，需要排查该组的规则

**痛点**:
- 设备逐个配置太慢，容易遗漏
- 规则修改后不清楚影响了哪些设备
- 无法快速查看某个组的规则优先级
- 删除组时不知道会影响到哪些设备

---

## 核心目标

### Life Goals（人生目标）
- "让网络管理自动化，减少人工干预"

### Experience Goals（体验目标）
- "操作流程顺畅，不需要反复确认"
- "能清楚看到操作的结果和影响范围"

### End Goals（终端目标）
- "快速将一批设备分组并应用规则"
- "安全地修改规则，不影响其他设备"
- "随时了解某个组的规则和设备清单"

---

## 关键场景设计

### 场景 1: 新员工入职

**目标**: 将 5 台新设备加入"研发部门"组并应用研发规则

**心理模型**: 创建篮子 → 放入设备 → 应用规则

**交互流程**:
1. Alex 进入"客户端分组"页面
2. 点击"新建分组"，输入"研发部门"（支持自动颜色生成）
3. 点击左侧"未分组"或搜索栏输入设备名/ID
4. 勾选 5 台设备（支持批量选择）
5. 点击"移动到组"按钮，选择"研发部门"
6. 右侧自动刷新，显示该组有 5 台设备
7. Alex 点击"绑定规则"按钮
8. 从规则列表中选择允许访问研发资源的关键词规则
9. 点击"保存"，看到成功提示

**关键决策点**:
- ✅ 设备选择后直接"移动到组"，而不是拖拽（移动端友好）
- ✅ 绑定规则时显示规则优先级说明
- ✅ 操作完成后显示"现在有 5 台设备应用了 3 条规则"

---

### 场景 2: 安全审计临时隔离

**目标**: 临时将所有 IoT 设备加入"隔离组"以阻断外部访问

**交互流程**:
1. Alex 在客户端列表中筛选"设备类型=IoT"
2. 全选所有 IoT 设备（10+ 台）
3. 点击"批量操作" → "移动到组" → "隔离组"
4. 系统提示："将 12 台设备移动到隔离组，这会应用以下规则：阻断外部访问"
5. Alex 确认后，看到设备列表更新
6. Alex 点击"测试"按钮，验证某台设备的 DNS 解析是否被拦截
7. 审计结束后，Alex 再次全选设备，移动回"未分组"

**关键决策点**:
- ✅ 批量操作前显示影响范围（设备数量 + 规则数量）
- ✅ 支持从组中移除设备（移除后应用全局规则）
- ✅ 提供"预览模式"：查看某组规则应用前的效果

---

### 场景 3: 规则冲突排查

**目标**: 某个部门无法访问某类网站，排查该组的规则

**交互流程**:
1. Alex 收到投诉："研发团队无法访问 GitHub"
2. Alex 进入"客户端分组" → 点击"研发部门"
3. 右侧显示该组的规则列表，按优先级排序：
   - 1. 阻断 `*github*`（客户端专属）
   - 2. 允许 `*研发资源*`（组规则）
4. Alex 发现第一条规则是某个客户端专属的（可能是某台开发机的临时限制）
5. Alex 点击规则左侧的"眼睛"图标，看到这条规则仅影响 1 台设备
6. Alex 删除该规则，或调整其优先级
7. Alex 点击"测试"按钮，输入某台研发设备的 IP，查看规则应用结果
8. 确认后，Alex 保存配置

**关键决策点**:
- ✅ 规则列表按优先级排序，客户端专属 > 组规则 > 全局规则
- ✅ 显示规则来源（全局/组专属/客户端专属）
- ✅ 提供"预览"功能：查看某设备的规则应用结果（不实际生效）
- ✅ 规则冲突时，高亮显示冲突项并给出建议

---

### 场景 4: 删除组

**目标**: 删除不再使用的组，需要了解影响范围

**交互流程**:
1. Alex 发现"测试组"已经没有设备使用
2. Alex 右键点击该组，选择"删除"
3. 系统弹出模态框：
   - "删除 '测试组' 后，组内的 0 台设备将移至 '未分组'"
   - "该组绑定的 3 条规则将解绑"
   - "此操作不可撤销，确定删除吗？"
4. Alex 确认删除
5. 系统显示："已删除测试组"

**关键决策点**:
- ✅ 删除前显示影响范围（设备数量 + 规则数量）
- ✅ 设备移至"未分组"而非删除（符合用户心理模型）
- ✅ 提供软删除或"归档"选项（可选）

---

## Anti-Persona: "完美主义者 Paul"

### 特征
- 追求极致的层级结构（嵌套 3-4 层）
- 认为每个设备只能属于一个组
- 喜欢复杂的规则优先级系统

### 设计决策对抗
- ❌ 不实现层级分组（扁平分组 + 多对多）
- ❌ 不强制一对一分组关系（支持一个设备属于多个组）
- ❌ 不实现复杂优先级（简单三级：客户端专属 > 组规则 > 全局规则）

---

## 设计验证清单

每次交互设计完成后，问以下问题：

1. **目标导向**: 这个流程是否帮助 Alex 达成他的目标？
2. **批量友好**: 是否支持一次处理多个设备/规则？
3. **影响可见**: 是否清楚显示了操作的影响范围？
4. **可撤销**: 关键操作是否支持撤销或预览？
5. **错误处理**: 如果 Alex 犯错，是否优雅地提醒而不是报错？

---

## 下一步

- [x] 定义 Persona 和场景
- [ ] 数据库设计（client_groups, client_group_memberships, client_group_rules）
- [ ] API 设计（RESTful 端点）
- [ ] UI 设计（左右布局 + 拖拽排序）
- [ ] 规则引擎集成（优先级逻辑）
