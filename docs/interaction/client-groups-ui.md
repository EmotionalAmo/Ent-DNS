# 客户端分组管理 — UI 设计

## 设计原则

遵循 **Goal-Directed Design**，UI 应该反映用户的心理模型：
- 左侧分组树（可视化分组结构）
- 右侧客户端列表（批量操作友好）
- 批量操作优先（减少点击次数）

---

## 页面布局

### 主页面：ClientGroupsPage

**布局结构**:
```
┌─────────────────────────────────────────────────────────┐
│  顶部导航: 仪表盘 | 客户端分组 | 规则管理 | ...           │
├──────────────┬──────────────────────────────────────────┤
│              │  搜索框: [搜索设备名/IP]                 │
│   分组树     ├──────────────────────────────────────────┤
│              │  批量操作栏: [已选 3 台]                  │
│  ▼ 研发部门  │              [移动到组] [复制到组]      │
│    (12)     │                                          │
│  ▼ 隔离组     │  客户端列表:                             │
│    (5)      │  ☑ 192.168.1.100  开发机-01  [研发][隔离]│
│  ▼ 市场部     │  ☑ 192.168.1.101  开发机-02  [研发]     │
│    (0)      │  ☐ 192.168.1.102  开发机-03  [研发]     │
│              │  ...                                     │
│ [+ 新建分组] │                                          │
└──────────────┴──────────────────────────────────────────┘
```

**设计决策**:
- ✅ 左侧分组树（280px 宽度，可拖拽调整）
- ✅ 右侧客户端列表（支持批量选择）
- ✅ 批量操作栏固定在顶部（始终可见）

---

## 组件设计

### 1. GroupTree 组件

**用途**: 显示所有分组，支持拖拽排序

**Props**:
```typescript
interface GroupTreeProps {
  groups: ClientGroup[];
  selectedGroupId: number | null;
  onSelectGroup: (groupId: number | null) => void;
  onCreateGroup: () => void;
  onReorder: (groupId: number, newIndex: number) => void;
  onDeleteGroup: (groupId: number) => void;
}
```

**UI 设计**:
```
┌─────────────────────────┐
│  ▼ 研发部门 (12)        │
│  ▼ 隔离组 (5)           │
│  ▼ 市场部 (0)           │
│                         │
│  [+ 新建分组]           │
└─────────────────────────┘
```

**交互行为**:
- ✅ 点击分组 → 右侧显示该组客户端
- ✅ 拖拽分组 → 调整排序优先级（调用 `onReorder`）
- ✅ 右键分组 → 上下文菜单（编辑、删除）
- ✅ 双击分组 → 编辑分组信息（名称、颜色、描述）

**颜色标记**:
- 每个分组左侧显示颜色标记（12px 圆点）
- 新建分组时自动生成颜色（从预设色板随机选择）

**预设色板**:
```typescript
const PRESET_COLORS = [
  '#6366f1', // Indigo
  '#ef4444', // Red
  '#22c55e', // Green
  '#eab308', // Yellow
  '#ec4899', // Pink
  '#8b5cf6', // Violet
  '#14b8a6', // Teal
  '#f97316', // Orange
];
```

---

### 2. ClientList 组件

**用途**: 显示客户端列表，支持批量选择和操作

**Props**:
```typescript
interface ClientListProps {
  clients: Client[];
  selectedClientIds: string[];
  onToggleClient: (clientId: string) => void;
  onToggleAll: () => void;
  onMoveToGroup: (groupIds: number[]) => void;
  onCopyToGroup: (groupIds: number[]) => void;
  onViewDetails: (clientId: string) => void;
}
```

**UI 设计**:
```
┌────────────────────────────────────────────────────────┐
│  搜索框: [搜索设备名/IP]                                │
├────────────────────────────────────────────────────────┤
│  批量操作栏: [已选 3 台]                                │
│              [移动到组] [复制到组] [查看详情]           │
├────────────────────────────────────────────────────────┤
│  ☑ 192.168.1.100  开发机-01  [研发][隔离]              │
│     00:11:22:33:44:55  最后在线: 2 分钟前              │
│  ☑ 192.168.1.101  开发机-02  [研发]                    │
│     00:11:22:33:44:56  最后在线: 5 分钟前              │
│  ☐ 192.168.1.102  开发机-03  [研发]                    │
│     00:11:22:33:44:57  最后在线: 10 分钟前             │
└────────────────────────────────────────────────────────┘
```

**交互行为**:
- ✅ 点击复选框 → 切换选中状态
- ✅ 点击复选框头部 → 全选/取消全选
- ✅ 点击客户端行 → 查看详情（跳转到详情页）
- ✅ 批量操作 → 弹出选择分组对话框

**批量移动对话框**:
```
┌─────────────────────────────────────┐
│  移动到组                            │
├─────────────────────────────────────┤
│  将 3 台设备移动到:                 │
│                                     │
│  ○ 研发部门 (12)                    │
│  ● 隔离组 (5)                       │
│  ○ 市场部 (0)                       │
│  ○ 未分组 (3)                       │
│                                     │
│  ⚠️ 这将应用以下规则:               │
│     - 阻断外部访问                  │
│                                     │
│  [取消]  [确认]                     │
└─────────────────────────────────────┘
```

---

### 3. GroupRulesPanel 组件

**用途**: 显示分组的规则列表，支持绑定/解绑规则

**Props**:
```typescript
interface GroupRulesPanelProps {
  groupId: number;
  groupName: string;
  rules: GroupRule[];
  onBindRule: (ruleId: number, ruleType: string, priority: number) => void;
  onUnbindRule: (ruleId: number, ruleType: string) => void;
  onReorder: (ruleId: number, newIndex: number) => void;
  onPreviewRules: (clientId: string) => void;
}
```

**UI 设计**:
```
┌────────────────────────────────────────────────────────┐
│  研发部门 - 规则 (3)                                    │
├────────────────────────────────────────────────────────┤
│  [+ 绑定规则]  [预览规则效果]                           │
├────────────────────────────────────────────────────────┤
│  1. 阻断外部访问               [👁️] [✏️] [🗑️]         │
│     *external*  block  优先级: 0                       │
│     应用于: 12 台设备                                   │
│  2. 允许研发资源               [👁️] [✏️] [🗑️]         │
│     *研发资源*  allow  优先级: 1                      │
│     应用于: 12 台设备                                   │
└────────────────────────────────────────────────────────┘
```

**交互行为**:
- ✅ 点击"绑定规则" → 弹出规则选择对话框
- ✅ 拖拽规则 → 调整优先级（调用 `onReorder`）
- ✅ 点击"👁️" → 查看规则详情（弹出模态框）
- ✅ 点击"✏️" → 编辑规则（跳转到规则编辑页）
- ✅ 点击"🗑️" → 解绑规则（弹出确认对话框）

**规则选择对话框**:
```
┌─────────────────────────────────────┐
│  绑定规则                           │
├─────────────────────────────────────┤
│  筛选: [全部 ▼]  [搜索规则名]      │
├─────────────────────────────────────┤
│  ☑ 阻断外部访问                     │
│     *external*  block               │
│  ☑ 允许研发资源                     │
│     *研发资源*  allow               │
│  ☐ 阻断社交媒体                     │
│     *social*  block                 │
│                                     │
│  [取消]  [确认 (已选 2)]            │
└─────────────────────────────────────┘
```

---

### 4. CreateGroupDialog 组件

**用途**: 创建/编辑分组

**Props**:
```typescript
interface CreateGroupDialogProps {
  open: boolean;
  group?: ClientGroup;
  onSave: (group: Partial<ClientGroup>) => void;
  onCancel: () => void;
}
```

**UI 设计**:
```
┌─────────────────────────────────────┐
│  新建分组                           │
├─────────────────────────────────────┤
│  分组名称:                          │
│  [研发部门                         ]│
│                                     │
│  颜色标记:                          │
│  ● ○ ○ ○ ○ ○ ○ (选择颜色)         │
│                                     │
│  描述:                              │
│  [研发团队设备                     ]│
│  [                                 ]│
│                                     │
│  [取消]  [保存]                     │
└─────────────────────────────────────┘
```

**交互行为**:
- ✅ 颜色标记 → 从预设色板中选择（点击切换）
- ✅ 分组名称 → 实时验证（重复时显示错误）
- ✅ 描述 → 可选字段

---

### 5. DeleteGroupDialog 组件

**用途**: 删除分组前的确认

**Props**:
```typescript
interface DeleteGroupDialogProps {
  open: boolean;
  group: ClientGroup;
  affectedClientCount: number;
  affectedRuleCount: number;
  onConfirm: () => void;
  onCancel: () => void;
}
```

**UI 设计**:
```
┌─────────────────────────────────────┐
│  删除分组                           │
├─────────────────────────────────────┤
│  ⚠️ 删除"研发部门"后:               │
│                                     │
│  • 组内的 12 台设备将移至"未分组"  │
│  • 该组绑定的 3 条规则将解绑        │
│                                     │
│  此操作不可撤销，确定删除吗？       │
│                                     │
│  [取消]  [删除]                     │
└─────────────────────────────────────┘
```

---

## 响应式设计

### 桌面端（> 1024px）

- 左侧分组树（280px）
- 右侧客户端列表（flex-1）
- 批量操作栏固定在顶部

### 平板端（768px - 1024px）

- 左侧分组树（240px）
- 右侧客户端列表（flex-1）
- 批量操作栏改为下拉菜单

### 移动端（< 768px）

- 分组树和客户端列表改为标签页切换
- 批量操作栏改为底部固定栏
- 规则面板改为全屏模态框

---

## 动效设计

### 拖拽排序

- **拖拽开始**: 元素半透明（opacity: 0.5）
- **拖拽过程**: 显示放置指示器（虚线边框）
- **拖拽结束**: 400ms 缓动动画（transition: transform 0.4s ease）

### 批量选择

- **选中**: 背景蓝色（background: #eff6ff）
- **全选**: 所有客户端同时高亮（100ms 交错动画）

### 删除确认

- **显示对话框**: 300ms 淡入动画
- **删除成功**: 绿色 Toast 提示（200ms 淡出）

---

## 错误处理

### 分组名称重复

```
┌─────────────────────────────────────┐
│  新建分组                           │
├─────────────────────────────────────┤
│  分组名称:                          │
│  [研发部门                         ]│
│  ❌ 该分组名已存在                  │
│                                     │
│  [取消]  [保存]                     │
└─────────────────────────────────────┘
```

### 批量移动失败

```
┌─────────────────────────────────────┐
│  ❌ 移动失败                        │
├─────────────────────────────────────┤
│  无法移动以下设备:                  │
│  • 192.168.1.999 (设备不存在)      │
│                                     │
│  已成功移动 2 台设备                │
│                                     │
│  [确定]                             │
└─────────────────────────────────────┘
```

---

## 无障碍设计

### 键盘导航

- `Tab`: 在分组树、客户端列表、批量操作栏之间切换
- `Enter`: 选中/取消选中客户端
- `Escape`: 关闭对话框
- `Ctrl/Cmd + A`: 全选客户端

### 屏幕阅读器

- 所有图标提供 `aria-label`
- 批量操作栏使用 `aria-live="polite"`（选中数量变化时播报）
- 颜色标记附加文本说明（如"紫色标记"）

---

## 性能优化

### 虚拟滚动

- 客户端列表超过 100 台时启用虚拟滚动
- 使用 `@tanstack/react-virtual` 或 `react-window`

### 防抖搜索

- 搜索框输入时防抖（300ms）
- 避免频繁请求 API

### 数据缓存

- 分组列表缓存 60s
- 客户端列表缓存 30s
- 规则列表缓存 60s

---

## 下一步

- [x] UI 组件设计
- [ ] 规则引擎集成逻辑
- [ ] 前端实现（GroupTree, ClientList, GroupRulesPanel）
- [ ] 后端实现（Model, Handler, Routes）
- [ ] 测试验证
