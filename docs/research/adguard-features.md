# AdGuard Home 功能清单分析报告

> 作者：research-thompson
> 日期：2026-02-19
> 用途：Ent-DNS Enterprise 功能对标参考

---

## 执行摘要

AdGuard Home 是一款优秀的家用/SOHO 级 DNS 过滤服务器，功能全面、易于部署。但它本质上是一个**单用户、单实例**的工具，在企业场景下存在根本性局限：无 RBAC、无多租户、无审计合规支持。这正是 Ent-DNS Enterprise 的差异化机会。

---

## 一、AdGuard Home 功能清单

### 1. DNS 服务器模式（对外服务协议）

| 功能 | 重要程度 | 备注 |
|------|----------|------|
| 标准 DNS（UDP/TCP port 53） | 🔴 必须 | 最基础协议 |
| DNS-over-HTTPS (DoH) | 🔴 必须 | 加密 DNS，浏览器原生支持 |
| DNS-over-TLS (DoT) | 🔴 必须 | 加密 DNS，移动端常用 |
| DNS-over-QUIC (DoQ) | 🟡 重要 | 基于 QUIC，低延迟 |
| DNSCrypt | 🟢 可选 | 老协议，仍有用户群 |

### 2. 上游 DNS 解析器（Upstream）

| 功能 | 重要程度 | 备注 |
|------|----------|------|
| 多 upstream 配置 | 🔴 必须 | 负载均衡/冗余 |
| 域名指定 upstream | 🔴 必须 | 特定域走特定解析器 |
| Parallel upstream 查询 | 🟡 重要 | 取最快响应 |
| Private reverse DNS | 🟡 重要 | 内网反向解析 |
| Bootstrap DNS | 🟡 重要 | 解析 DoH/DoT 服务器域名 |
| Fallback DNS | 🟡 重要 | 主 upstream 失败时备用 |

### 3. DNS 过滤与拦截

| 功能 | 重要程度 | 备注 |
|------|----------|------|
| 订阅式拦截列表（Blocklist） | 🔴 必须 | 支持 hosts/AdGuard/ABP 格式 |
| 自定义拦截规则 | 🔴 必须 | AdGuard DNS 语法 |
| 域名白名单（Allowlist） | 🔴 必须 | 排除误拦截 |
| 安全浏览（Phishing/Malware） | 🔴 必须 | 对接安全数据库 |
| 广告过滤 | 🔴 必须 | 核心功能 |
| 追踪器过滤 | 🔴 必须 | 隐私保护 |
| 家长控制（Adult 内容过滤） | 🟡 重要 | 适合 K-12 场景 |
| 安全搜索强制（Safe Search） | 🟡 重要 | Google/Bing/YouTube |
| 服务拦截（YouTube/Twitter 等） | 🟢 可选 | 按服务分类拦截 |

### 4. DNS 重写（Rewrites）

| 功能 | 重要程度 | 备注 |
|------|----------|------|
| DNS 重写（域名→IP/域名） | 🔴 必须 | 内网解析、split-DNS |
| 通配符重写 | 🔴 必须 | `*.internal.company → IP` |

### 5. DNSSEC

| 功能 | 重要程度 | 备注 |
|------|----------|------|
| DNSSEC 验证（递归解析时） | 🟡 重要 | 验证上游响应签名 |
| DNSSEC 标志位传递 | 🟡 重要 | DO bit forwarding |

### 6. 客户端管理

| 功能 | 重要程度 | 备注 |
|------|----------|------|
| 客户端识别（IP/MAC/名称） | 🔴 必须 | 设备级管理 |
| 每客户端独立过滤规则 | 🔴 必须 | 个性化策略 |
| 每客户端独立 upstream | 🟡 重要 | 不同设备走不同 DNS |
| 访问控制列表（ACL） | 🔴 必须 | 允许/拒绝特定 IP 查询 |
| 持久化客户端配置 | 🔴 必须 | 设备信息持久保存 |

### 7. 查询日志（Query Log）

| 功能 | 重要程度 | 备注 |
|------|----------|------|
| 实时查询日志 | 🔴 必须 | 按域名/客户端过滤 |
| 日志保留时间配置 | 🔴 必须 | 可关闭/设置天数 |
| 查询日志导出 | 🟡 重要 | CSV/JSON 导出 |
| 从日志一键加入黑白名单 | 🟡 重要 | 操作便捷性 |

### 8. 统计与仪表盘

| 功能 | 重要程度 | 备注 |
|------|----------|------|
| 总查询数/拦截数统计 | 🔴 必须 | 基础指标 |
| Top 拦截域名 | 🔴 必须 | 过滤效果可视化 |
| Top 活跃客户端 | 🔴 必须 | 设备活动监控 |
| 时间趋势图 | 🟡 重要 | 历史数据分析 |
| 统计保留周期配置 | 🟡 重要 | 磁盘管理 |

### 9. 加密与 TLS

| 功能 | 重要程度 | 备注 |
|------|----------|------|
| 管理界面 HTTPS | 🔴 必须 | 安全访问后台 |
| 证书自动申请（Let's Encrypt） | 🟡 重要 | 降低运维成本 |
| 自定义证书导入 | 🔴 必须 | 企业内部 CA |

### 10. 部署与集成

| 功能 | 重要程度 | 备注 |
|------|----------|------|
| REST API | 🔴 必须 | 自动化集成 |
| Docker 部署支持 | 🔴 必须 | 容器化部署 |
| 配置文件导入/导出 | 🟡 重要 | 备份与迁移 |
| 更新检查 | 🟢 可选 | 版本通知 |

---

## 二、AdGuard Home 的企业场景局限性

这是 Ent-DNS 的核心差异化机会：

| 局限性 | 影响 | Ent-DNS 解决方案 |
|--------|------|-----------------|
| **无 RBAC** | 只有一个 admin，无法多人协作管理 | 细粒度 RBAC（只读/操作员/管理员/超级管理员） |
| **无多租户** | 无法为不同部门/客户提供隔离环境 | 租户隔离，独立规则/统计/日志 |
| **无审计日志** | 无法满足合规要求（SOC2/ISO27001） | 完整的操作审计日志，可导出 |
| **无 SSO/LDAP** | 企业无法集成现有身份系统 | LDAP/OIDC/SAML 集成 |
| **无 HA/集群** | 单点故障，无法高可用部署 | 多节点管理，主备/负载均衡 |
| **无 SIEM 集成** | 日志无法接入企业安全平台 | Syslog/Webhook/Elasticsearch 输出 |
| **有限 API** | API 功能不完整，自动化受限 | 完整 OpenAPI 规范，所有功能可 API 化 |
| **无限速/配额** | 无法对客户端限制查询频率 | 每客户端 QPS 限制 |
| **无 AD/组策略** | 无法基于 AD 组应用不同策略 | 与 Active Directory 集成 |
| **无指标导出** | 无法接入 Prometheus/Grafana | Prometheus metrics endpoint |

---

## 三、Ent-DNS Phase 1 功能优先级（前 10 个）

基于"企业痛点最大 + 实现可行性高"原则排序：

| 优先级 | 功能 | 理由 |
|--------|------|------|
| 1 | 标准 DNS 服务器（UDP/TCP 53） | 核心基础，必须先跑起来 |
| 2 | DNS 过滤（黑名单订阅 + 自定义规则） | 核心价值，对标 AdGuard 的主功能 |
| 3 | DNS 重写 | 企业内网必需，split-DNS |
| 4 | DoH/DoT 服务端支持 | 加密 DNS 是现代企业必备 |
| 5 | 查询日志 | 可视性，企业合规需求 |
| 6 | RBAC 权限管理 | 核心差异化，AdGuard 缺失 |
| 7 | 客户端管理（IP/ACL） | 设备级管控，基础企业功能 |
| 8 | 统计仪表盘 | 管理可见性 |
| 9 | REST API（完整） | 企业自动化集成 |
| 10 | 审计日志 | 合规硬需求 |

**Phase 2 预留**：多租户、DoQ、LDAP/SSO、Prometheus、多节点管理、SIEM 集成

---

## 四、关键洞察

1. **AdGuard Home 是"足够好"的家用工具，但企业场景有巨大空白**：单用户模型、无 RBAC、无审计日志是根本性缺陷，不是通过修改配置能解决的，而是架构设计层面的问题。

2. **DNS 协议支持是准入门槛，不是差异化**：DoH/DoT/DNSCrypt 必须支持，否则不入场。差异化在企业管控层（RBAC、审计、多租户、AD 集成）。

3. **查询日志 + 审计日志是两个不同的概念**：AdGuard 的查询日志（DNS Query Log）是 DNS 流量记录；企业需要的审计日志（Audit Log）是"谁、在什么时候、做了什么配置变更"的操作记录。两者都需要，但功能不同，切勿混淆。
