# Ent-DNS 战略回顾与规划报告

**报告人**: CEO Jeff Bezos
**报告日期**: 2026-02-20
**参与角色**: CTO (Vogels)、Product (Norman)、Research (Thompson)、CFO (Campbell)、Critic (Munger)

---

## 执行摘要

Ent-DNS 是一个设计良好的企业级 DNS 过滤服务器，采用 Rust + Axum 技术栈，核心功能完整，15 个安全问题已全部修复。当前生产就绪度 8.2/10，建议在完成 P1 优先级优化后发布 v1.0。

**核心优势**：
1. **性能优势**：Rust 异步架构，预估 QPS 10,000+，优于 Go 实现（AdGuard Home 5,000+）和 PHP 实现（Pi-hole 1,000+）
2. **企业管控**：RBAC 权限管理 + 审计日志，竞品缺失的核心功能
3. **用户体验**：现代 Web UI（React + Tailwind + shadcn/ui），实时查询日志，批量操作高效

**关键风险**：
1. **DoH/DoT 缺失**（Critical）：现代浏览器默认使用 DoH，不支持会导致用户流失
2. **性能瓶颈**（Critical）：SQLite 单点写入瓶颈，高并发场景可能崩溃
3. **用户体验差距**（High）：首次使用引导缺失，规则语法错误提示不明确

**战略建议**：
- **短期（1 个月）**：完成 DoH/DoT 支持、性能压力测试、Onboarding 引导、规则语法验证
- **中期（3 个月）**：客户端分组管理、高级过滤规则、告警通知系统
- **长期（12 个月）**：多租户支持、SSO/LDAP 集成、商业化实现 265 付费客户目标

---

## 一、现状总结（3-5 个核心优势）

### 1. 技术架构领先

**CTO 评估**：8.2/10（推荐生产部署）

- **性能优势**：Rust 异步架构 + Tokio，预估 QPS 10,000+，内存占用 ~50MB（Pi-hole ~200MB）
- **智能缓存**：DNS 缓存 + 客户端配置缓存（60s TTL） + Resolver 缓存，热路径无阻塞操作
- **安全性**：15 个安全问题全部修复（2 Critical + 5 High + 5 Medium + 3 Low）

**适用场景**：
- ✅ 中小企业内网 DNS 过滤（10-1,000 设备）
- ✅ 家庭网络家长控制
- ✅ 云端单实例部署（Docker Compose / systemd）
- ❌ 大型企业（需 PostgreSQL + 集群部署）
- ❌ 全球 CDN（需分布式架构）

### 2. 企业管控完整

**差异化优势**：竞品缺失的核心功能

| 功能 | Ent-DNS | AdGuard Home | Pi-hole | Blocky |
|------|----------|--------------|---------|---------|
| RBAC 权限管理 | ✅ (3 角色) | ❌ | ❌ | ❌ |
| 审计日志 | ✅ | ❌ | ❌ | ❌ |
| Prometheus 指标 | ✅ | ❌ | ⚠️ (第三方) | ❌ |

**商业价值**：**极高**（企业合规硬需求）

### 3. 用户体验现代化

**Product 评估**：7.5/10（Dashboard 优秀，首次引导缺失）

**优势**：
- Dashboard 信息密度适中，实时反馈良好（5 秒刷新）
- 规则批量操作（启用/禁用/删除）效率高
- 实时查询日志 WebSocket 推送流畅
- 强制改密保护提升安全体验

**差距**：
- 首次使用引导缺失（无 onboarding）
- 规则语法错误提示不明确
- 客户端分组管理缺失
- 查询日志高级过滤能力不足

### 4. 市场定位清晰

**Research 评估**：聚焦企业级自托管 DNS 过滤器

**目标市场**：
- 中小企业（10-1,000 设备）：占比 35%
- 教育机构：占比 25%
- 家庭高级用户：占比 40%

**差异化定位**：
```
          高企业功能
                ↑
    Cloudflare for Teams
        (SaaS)

    AdGuard Home ---+--- Ent-DNS
    (家用)          |
                |
    Pi-hole / Blocky
        (开源)
                ↓
          低企业功能
```

**竞争策略**：
- 避开 AdGuard Home 的功能全面度（DoH/DoT/DNSCrypt、时间段规则、家长控制）
- 聚焦企业级管控（RBAC + 审计日志）
- 超越性能（Rust vs Go/PHP）

### 5. 商业化路径可行

**CFO 评估**：LTV/CAC 3.48（健康）

**单位经济学**：
- LTV（客户生命周期价值）：$348
- CAC（获客成本）：$100（开源驱动，低成本）
- LTV/CAC 比例：3.48（健康，>3）
- 盈亏平衡：128 付费客户

**收入预测（12 个月）**：
- 目标：265 付费客户
- MRR：$7,727（订阅 + 支持）
- ARR：$92,724

**定价策略**：
- Community（免费）：完整功能、社区支持
- Pro（$29/月）：多租户、SSO/LDAP、优先支持（50 设备）
- Enterprise（定制）：SLA 99.9%、专属支持、现场培训

---

## 二、改进优先级矩阵（P1/P2/P3）

### 2.1 优先级分类标准

| 维度 | P1（发布前必修） | P2（近期计划） | P3（长期规划） |
|------|------------------|----------------|----------------|
| **用户影响** | 极高（Critical） | 高（High） | 中（Medium） |
| **失败概率** | >70% | 40-70% | <40% |
| **工作量** | ≤2 周 | 2-4 周 | >4 周 |
| **商业价值** | 极高（准入门槛） | 高（差异化） | 中（锦上添花） |

### 2.2 P1 优先级（发布前必修）

| 优先级 | 项目 | 失败模式 | 工作量 | 影响 |
|--------|------|---------|--------|------|
| **P1-1** | DoH/DoT 支持 | F-3: 用户流失 | 2-3 周 | 准入门槛 |
| **P1-2** | 性能压力测试 | F-1: 服务崩溃 | 1 周 | 生产可靠性 |
| **P1-3** | 第三方安全审计 | F-2: 安全漏洞 | 1 周 | 数据安全 |
| **P1-4** | Onboarding 引导 | F-5: 用户体验差 | 3 天 | 新用户留存 |
| **P1-5** | 规则语法实时验证 | F-5: 用户体验差 | 2 天 | 用户挫败感减少 |

**总计**：4 周（1 个月）

### 2.3 P2 优先级（近期计划）

| 优先级 | 项目 | 失败模式 | 工作量 | 影响 |
|--------|------|---------|--------|------|
| **P2-1** | 客户端分组管理 | F-5: 用户体验差 | 1 周 | 企业用户满意度 |
| **P2-2** | 高级过滤规则（正则/时间/条件） | F-4: 竞品追赶 | 1 周 | 高级用户需求 |
| **P2-3** | 告警通知系统 | F-8: 商业化失败 | 1 周 | 运维效率提升 |
| **P2-4** | 查询日志高级过滤 | F-5: 用户体验差 | 3 天 | 日志排查效率 |
| **P2-5** | 查询日志迁移 ClickHouse | F-9: SQLite 瓶颈 | 2 周 | 长期数据分析 |
| **P2-6** | 快速迭代 + 社区建设 | F-4: 竞品追赶 | 持续 | 抢占市场先机 |

**总计**：6 周（1.5 个月）

### 2.4 P3 优先级（长期规划）

| 优先级 | 项目 | 失败模式 | 工作量 | 影响 |
|--------|------|---------|--------|------|
| **P3-1** | 多租户支持 | F-12: 企业版缺失 | 3 周 | 商业化路径 |
| **P3-2** | SSO/LDAP 集成 | F-12: 企业版缺失 | 2 周 | 企业级功能 |
| **P3-3** | PostgreSQL 多实例部署 | F-9: 高可用 | 4 周 | 企业级架构 |
| **P3-4** | API 密钥管理 | F-8: 商业化失败 | 3 天 | 第三方集成 |
| **P3-5** | Kubernetes/Helm 部署 | F-4: 云原生趋势 | 2 周 | DevOps 友好 |

**总计**：10 周（2.5 个月）

---

## 三、研发方向建议（3-5 个具体方向）

### 方向 1：DoH/DoT 支持（P1-1）

**动机**：
- 现代浏览器（Chrome/Firefox）默认使用 DoH
- 不支持会导致 Ent-DNS 被绕过，用户流失
- 竞品已实现（AdGuard Home、Blocky）

**实现方案**：
- DoH: `/dns-query` GET 端点（RFC 8484），Base64 编码 DNS 查询
- DoT: TCP 853 端口，TLS 证书自动续期（Let's Encrypt）
- 依赖：hickory-resolver 已支持 DoH/DoT，仅需暴露端点

**工作量**：2-3 周

**验收标准**：
- Chrome/浏览器测试 DoH 连接
- 客户端测试 DoT 连接
- 性能测试（10,000 QPS）

### 方向 2：性能优化与监控（P1-2）

**动机**：
- SQLite 单点写入瓶颈，高并发场景可能崩溃
- 未进行压力测试，性能瓶颈未提前发现

**实现方案**：
- 压力测试：使用 `dnsperf` 压力测试，验证 10,000 QPS 目标
- 性能监控：Prometheus 指标（`dns_query_latency_ms`、`db_write_latency_ms`）
- 告警规则：P99 延迟 > 100ms 触发告警

**工作量**：1 周

**验收标准**：
- 10,000 QPS 持续 60 分钟无崩溃
- P99 延迟 < 100ms
- 内存占用 < 100MB

### 方向 3：Onboarding 引导与规则语法验证（P1-4、P1-5）

**动机**：
- 新用户不知道下一步做什么（首次使用引导缺失）
- 规则语法错误提示不明确（用户挫败感强）

**实现方案**：
- Onboarding 引导：3 步引导（添加过滤列表 → 配置客户端 → 查看日志）
- 规则语法验证：实时验证 AdGuard 语法，友好错误提示

**工作量**：5 天

**验收标准**：
- 新用户完成引导率 ≥ 80%
- 规则创建错误率 ≤ 5%

### 方向 4：客户端分组管理（P2-1）

**动机**：
- 企业用户需要分组管理（办公室、家庭、访客）
- 组级别配置（过滤开关、上游 DNS）
- 组级别统计（查询量、拦截率）

**实现方案**：
- 数据库表：`client_groups`（group_id, name, filter_enabled, upstreams）
- 前端页面：Groups 页面（CRUD + 拖拽排序）
- API 端点：`GET/POST/PUT/DELETE /api/v1/groups`

**工作量**：1 周

**验收标准**：
- 支持创建/编辑/删除客户端组
- 支持客户端分配到组
- 支持组级别配置

### 方向 5：高级过滤规则（P2-2）

**动机**：
- 用户需要更灵活的过滤规则（正则表达式、时间段规则、条件规则）
- 竞品支持（Blocky 支持正则和条件规则）

**实现方案**：
- 正则表达式：支持 `||example.com^` 变为 `||.*\.example\.com^`
- 时间段规则：支持 `||social-media.com^ time:09:00-18:00`
- 条件规则：支持 `||example.com^ client:192.168.1.0/24`

**工作量**：1 周

**验收标准**：
- 正则表达式规则生效
- 时间段规则生效
- 条件规则生效

---

## 四、资源分配建议

### 4.1 人力资源

| 角色 | 现状 | 建议 | 理由 |
|------|------|------|------|
| **开发者** | 1 名（兼职） | 增加 1 名（全职） | 加快 P1 任务完成，抢占市场先机 |
| **产品经理** | 0 名（创始人兼任） | 增加 1 名（兼职） | 优化用户体验，提升付费转化 |
| **测试工程师** | 0 名（开发者兼任） | 增加 1 名（兼职） | 建立测试体系，降低 Bug 率 |
| **社区运营** | 0 名（创始人兼任） | 增加 1 名（兼职） | 建设 GitHub/Discord 社区，提升用户粘性 |

### 4.2 资金预算（12 个月）

| 类别 | 月成本 | 年成本 | 备注 |
|------|--------|--------|------|
| **开发者** | $2,000 | $24,000 | 1 名全职 + 1 名兼职 |
| **产品经理** | $500 | $6,000 | 兼职 |
| **测试工程师** | $500 | $6,000 | 兼职 |
| **社区运营** | $300 | $3,600 | 兼职 |
| **服务器成本** | $100 | $1,200 | 文档站点、Docker Hub、CI/CD |
| **第三方服务** | $200 | $2,400 | 安全审计、支付处理、监控 |
| **营销成本** | $500 | $6,000 | 技术博客、社区推广 |
| **总计** | $4,100 | $49,200 | |

### 4.3 资金来源

| 来源 | 金额 | 备注 |
|------|------|------|
| **自有资金** | $30,000 | 创始人投入 |
| **开源基金** | $10,000 | 申请 NLnet、Mozilla OSS 等基金 |
| **付费客户收入** | $92,724 | 12 个月预测收入 |
| **总计** | $132,724 | 足够支撑 12 个月运营 |

---

## 五、下一步行动计划

### 5.1 第 1 个月（发布准备）

| 周次 | 任务 | 负责人 | 产出 |
|------|------|--------|------|
| **Week 1** | DoH 端点实现 | 开发者 | `/dns-query` GET 端点 |
| **Week 2** | DoT 端点实现 | 开发者 | TCP 853 端口 |
| **Week 3** | 性能压力测试 | 测试工程师 | 性能测试报告 |
| **Week 4** | Onboarding 引导 + 规则语法验证 | 产品经理 + 开发者 | 引导流程 + 语法验证 |

**里程碑**：v1.0 发布（含 DoH/DoT 支持）

### 5.2 第 2-3 个月（功能完善）

| 周次 | 任务 | 负责人 | 产出 |
|------|------|--------|------|
| **Week 5-6** | 客户端分组管理 | 开发者 | Groups 页面 + API |
| **Week 7-8** | 高级过滤规则 | 开发者 | 正则/时间/条件规则 |
| **Week 9-10** | 告警通知系统 | 开发者 | 邮件/Slack/Telegram 告警 |
| **Week 11-12** | 查询日志高级过滤 | 开发者 | 高级过滤面板 |

**里程碑**：v1.1 发布（含客户端分组、高级过滤、告警通知）

### 5.3 第 4-6 个月（商业化）

| 周次 | 任务 | 负责人 | 产出 |
|------|------|--------|------|
| **Week 13-14** | GitHub 星标驱动 | 社区运营 | 1K Stars |
| **Week 15-16** | Product Hunt 发布 | 社区运营 | Top 10 |
| **Week 17-18** | 技术博客推广 | 社区运营 | Hacker News 首页 |
| **Week 19-20** | YouTube/B 站教程 | 社区运营 | 10 个教程视频 |
| **Week 21-24** | 付费支持服务 | 客户成功 | 50 付费客户 |

**里程碑**：50 付费客户（$1,450 MRR）

### 5.4 第 7-12 个月（规模化）

| 月次 | 目标 | 负责人 | 产出 |
|------|------|--------|------|
| **M7-9** | 多租户支持 | 开发者 | 企业版功能 |
| **M10-12** | SSO/LDAP 集成 | 开发者 | 企业级功能 |
| **全年** | 265 付费客户 | 全体 | $7,727 MRR |

**里程碑**：265 付费客户（$7,727 MRR，$92,724 ARR）

---

## 六、决策建议

### 6.1 发布时机决策

**建议**：完成 P1 优先级后立即发布 v1.0

**理由**：
- DoH/DoT 是准入门槛，必须支持
- 性能测试和第三方安全审计是生产可靠性保证
- Onboarding 引导和规则语法验证是用户体验基础

**风险**：延迟发布会导致竞品抢占市场先机

### 6.2 资源投入决策

**建议**：增加 1 名全职开发者 + 1 名兼职测试工程师

**理由**：
- 加快 P1 任务完成，抢占市场先机
- 建立测试体系，降低 Bug 率

**风险**：资金压力增加（月成本增加 $2,500）

### 6.3 商业化路径决策

**建议**：采用开源免费 + 企业付费模式

**理由**：
- 单位经济学健康（LTV/CAC 3.48）
- 开源驱动获客成本低（$100/客户）
- 企业版差异化价值高（RBAC + 审计日志）

**风险**：付费转化率低于预期（目标 10%）

---

## 七、结论

Ent-DNS 是一个设计良好的企业级 DNS 过滤服务器，核心优势明显（性能、企业管控、用户体验），但存在关键风险（DoH/DoT 缺失、性能瓶颈、用户体验差距）。

**战略建议**：
1. **短期（1 个月）**：完成 P1 优先级（DoH/DoT、性能测试、Onboarding 引导），发布 v1.0
2. **中期（3 个月）**：完成 P2 优先级（客户端分组、高级过滤、告警通知），发布 v1.1
3. **长期（12 个月）**：实现商业化目标（265 付费客户，$7,727 MRR）

**关键成功因素**：
- **速度**：快速迭代，抢占市场先机
- **质量**：压力测试、安全审计、自动化测试
- **社区**：GitHub 星标驱动、Discord 社区建设
- **差异化**：聚焦企业级管控（RBAC + 审计日志）

**预期结果**：
- 12 个月内达到 265 付费客户
- 实现 $7,727 MRR，$92,724 ARR
- 建立 1K+ GitHub Stars 社区
- 成为中小企业 DNS 过滤器首选

---

**签名**: Jeff Bezos, CEO
**日期**: 2026-02-20
