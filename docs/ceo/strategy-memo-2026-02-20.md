# 战略备忘录：Ent-DNS 下一阶段规划

**日期**：2026-02-20
**作者**：CEO (Bezos 思维模型)
**状态**：决策生效

---

## 一、产品定位

**目标市场：中小企业（SMB）IT 管理员，以及有家庭网络控制需求的技术型个人用户。**

原因：

- Pi-hole 统治家庭/极客市场，但部署复杂、UI 落后、不支持多用户。
- AdGuard Home 个人体验好，但多租户/RBAC 几乎不存在，企业客户用不了。
- Technitium 功能全但 UI 笨重，学习曲线高。
- Ent-DNS 已有 RBAC + 审计日志 + 完整 API，这是 SMB 场景的刚需，而竞品均无。

**一句话定位**：给 5-500 人规模企业的 IT 管理员用的、可自托管的 DNS 过滤与管理平台，比 Pi-hole 专业，比商业产品便宜。

---

## 二、功能优先级矩阵

### P0（必须做，直接影响能否交付给第一批用户）

| 功能 | 理由 |
|------|------|
| DoH 对外暴露端点 | 企业场景中，客户端（手机/BYOD）需要 DoH，否则 DNS 过滤形同虚设；这是竞品标配 |
| Client-specific upstream | SMB 核心场景：不同部门/VLAN 走不同上游，这是区别于 Pi-hole 的关键差异化点 |

### P1（重要，第二个 Milestone 交付）

| 功能 | 理由 |
|------|------|
| 告警规则（拦截率突变） | 企业客户需要"有事通知我"，而不是主动盯 Dashboard；这是从工具变成系统的关键一步 |
| Rate limiting（API 层） | 生产环境安全基线，没有这个企业客户不敢暴露管理端口 |

### P2（未来版本，不影响当前交付）

| 功能 | 理由 |
|------|------|
| 多租户/组织隔离 | 只有 SaaS 化时才需要，自托管场景 RBAC 已够用 |

---

## 三、差异化机会（护城河）

竞品最大的共同弱点是：**要么个人友好但企业不能用，要么企业级但部署地狱**。

Ent-DNS 的护城河可以建在三处：

1. **RBAC + 审计日志作为标配**：这是企业合规（ISO 27001、等保）的基础要求，竞品均需插件或不支持。把这个体验做到开箱即用，IT 管理员就不需要再找其他解决方案。

2. **API-first 设计**：现有 REST API 完整，未来可以让企业通过 Terraform/Ansible 管理 DNS 规则，这是 Pi-hole/AdGuard Home 完全空白的领域。

3. **Client-specific upstream（一旦实现）**：这个功能在竞品里几乎找不到完整实现，却是多部门/多 VLAN 企业网络的刚需。一旦做好，就是真正的差异化护城河。

---

## 四、下一个里程碑

**Milestone: "Enterprise-Ready v1.0"**
目标：让一家真实的 SMB 可以完整使用，不需要我们在旁边陪着。

**交付内容（按优先级）：**

1. DoH 端点上线（`/dns-query` 支持 RFC 8484）
2. Client-specific upstream（至少支持按 IP 段路由到不同上游）
3. API 层 Rate limiting（基础防护）
4. 告警规则 MVP（拦截率阈值触发 Webhook 通知）
5. 一份给 IT 管理员的部署文档（不是开发者文档）

**判断标准**：一个没有看过代码的 IT 管理员，能在 30 分钟内用 Docker Compose 部署完，并让公司所有设备走 Ent-DNS。

---

## 五、风险识别

| 风险 | 严重度 | 性质 |
|------|--------|------|
| 没有真实用户验证，在自嗨 | 高 | 商业风险（单向门） |
| SQLite 在高并发 DNS 查询下成为瓶颈 | 中 | 技术风险（可逆，可迁移） |
| 竞品（尤其 AdGuard Home）加快企业功能 | 中 | 市场风险 |
| 维护者单点（只有一个开发者） | 高 | 运营风险 |

**最大风险**：没有第一个真实客户。功能再多，没有人用等于零。

**行动建议**：在 Milestone v1.0 完成前，找 1-3 个愿意试用的 IT 管理员（朋友公司、Discord 社群、Reddit r/selfhosted），让他们在真实网络环境中跑起来。他们的反馈比任何内部讨论都有价值。

---

## 六、Next Action

1. 立即启动 DoH 端点实现（P0，本周内）
2. 并行设计 Client-specific upstream 的数据模型
3. 在 GitHub 上开 public repo，写 README，开始积累社区曝光
4. 找到第一个愿意试用的真实 IT 管理员

**CEO 决策**：DoH 是解锁企业场景的钥匙，优先级高于一切。没有 DoH，手机和 BYOD 设备无法强制走 Ent-DNS，整个过滤方案就有漏洞。先做这个，再做告警。
